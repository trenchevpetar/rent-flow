import{x as O,C as h,I as W,Q as Y,d as E,y as N,z as T,c as o,q as b,A as F,t as p,B as Q,b as i,o as l,D as ee,F as $,m as j,u as G,r as A,E as D,a as U,e as v,f as B,g as d,_ as te,w as se,G as H,H as ne,J as ae,K as le,L,k as K,M as oe,i as z,s as q,l as V,p as M,j as ie,N as re,v as ue}from"./index-DyqyX6ML.js";import{T as de,a as R,_ as ce}from"./TheSkeletonCircleContent-utyUHbVd.js";const I={DEFAULT:{abbr:"RENT",label:"Rent",value:"RENT",imageUrl:""},EVN:{abbr:"EVN",label:"EVN Group Macedonia",value:"EVN",imageUrl:"https://www.evn.mk/EVN/media/img/EVN-Logo.svg?ext=.svg"},VODOVOD:{abbr:"VODOVOD",label:"JP Vodovod",value:"VODOVOD",imageUrl:"https://vodovod-skopje.com.mk/images/logo_voda.png"},ESM:{abbr:"ESM",label:"ESM Snabduvanje so toplina",value:"ESM",imageUrl:"https://esm-snabduvanje.mk/wp-content/uploads/2022/12/logo_esm_privremeno.png"},URBAN:{abbr:"URBAN",label:"Urban Komfort",value:"URBAN",imageUrl:"https://urban.com.mk/img/logo-urbankonfort.png"},TELEKOM:{abbr:"TELEKOM",label:"Makedonski Telekom",value:"TELEKOM",imageUrl:"https://www.telekom.mk/images/telekom-logo.svg"}},me=()=>Object.keys(I).map(e=>{const t=e;return{label:I[t].label,value:I[t].value}});function pe(e){const t=Object.entries(e).filter(([r])=>!r.startsWith("$"));return Object.fromEntries(t)}async function ve(e){try{return await O.createDocument(h.DATABASE_ID,h.COLLECTIONS.EXPENSES,W.unique(),e)}catch(t){throw console.log(t),t}}async function ge(e){try{return(await O.listDocuments(h.DATABASE_ID,h.COLLECTIONS.EXPENSES,[Y.equal("propertyId",e)])).documents}catch(t){throw console.log("error fetching expenses"),t}}async function ye(e){try{return await O.deleteDocument(h.DATABASE_ID,h.COLLECTIONS.EXPENSES,e)}catch(t){throw console.log(t),t}}async function fe(e,t){const r=pe(t);try{return await O.updateDocument(h.DATABASE_ID,h.COLLECTIONS.EXPENSES,e,r)}catch(a){throw console.log(a),a}}const be={class:"fieldset"},_e={key:0,class:"fieldset-label"},xe=E({__name:"InputDate",props:N({label:{type:String,default:""}},{modelValue:{type:[Date,String],default:new Date().toISOString()},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=T(e,"modelValue");return(r,a)=>(l(),o("fieldset",be,[e.label?(l(),o("legend",_e,p(e.label),1)):b("",!0),F(i("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>t.value=s),type:"date",class:"input w-full"},null,512),[[Q,t.value]])]))}}),he={class:"fieldset"},Ee={key:0,class:"fieldset-label"},Se={disabled:"",selected:""},Ve=["value"],$e=E({__name:"InputSelect",props:N({label:{type:String,default:""},defaultValue:{type:String,default:"Pick option"},items:{type:Array,default:()=>[{value:"single",label:"Single"}]}},{modelValue:{type:String},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=T(e,"modelValue");return(r,a)=>(l(),o("fieldset",he,[e.label?(l(),o("legend",Ee,p(e.label),1)):b("",!0),F(i("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>t.value=s),class:"select w-full"},[i("option",Se,p(e.defaultValue),1),(l(!0),o($,null,j(e.items,(s,n)=>(l(),o("option",{key:n,value:s.value},p(s.label),9,Ve))),128))],512),[[ee,t.value]])]))}}),ke={class:"fieldset"},we={class:"fieldset-label"},Ie=["placeholder"],De={class:"fieldset-label"},Ae=E({__name:"InputTextarea",props:N({label:{type:String,default:""},placeholder:{type:String,default:""},optionalText:{type:String,default:""}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=T(e,"modelValue");return(r,a)=>(l(),o("fieldset",ke,[i("legend",we,p(e.label),1),F(i("textarea",{"onUpdate:modelValue":a[0]||(a[0]=s=>t.value=s),class:"textarea h-24 w-full",placeholder:e.placeholder},null,8,Ie),[[Q,t.value]]),i("div",De,p(e.optionalText),1)]))}}),Ce={class:"fieldset w-full"},Me=E({__name:"AddExpenseToPropertyForm",emits:["on-add-expense"],setup(e,{emit:t}){const r=t,a=H(),s=G(),n=A({propertyId:"",category:"Expense type",amount:0,description:"",date:new Date,isPaid:!1}),_=A(!1),y=D(()=>me()),{mutate:x,isPending:f}=U({mutationFn:ve,onSuccess:()=>{s.invalidateQueries({queryKey:["expenses"]}),r("on-add-expense")}}),c=async()=>{x({...n.value,propertyId:a.params.id.toString()})};return(S,m)=>(l(),o($,null,[i("form",{onSubmit:se(c,["prevent"]),class:"flex justify-center align-center items-center"},[v(B,{"is-loading":d(f)},null,8,["is-loading"]),i("fieldset",Ce,[v($e,{modelValue:n.value.category,"onUpdate:modelValue":m[0]||(m[0]=u=>n.value.category=u),items:y.value,"default-value":"Expense type",label:"Expense categories"},null,8,["modelValue","items"]),v(te,{modelValue:n.value.amount,"onUpdate:modelValue":m[1]||(m[1]=u=>n.value.amount=u),label:"Amount",placeholder:"Amount",type:"number"},null,8,["modelValue"]),v(Ae,{modelValue:n.value.description,"onUpdate:modelValue":m[2]||(m[2]=u=>n.value.description=u),label:"Description"},null,8,["modelValue"]),v(xe,{modelValue:n.value.date,"onUpdate:modelValue":m[3]||(m[3]=u=>n.value.date=u),label:"Date when expense is opened"},null,8,["modelValue"]),m[4]||(m[4]=i("div",{class:"flex w-full justify-end gap-2 mt-2"},[i("button",{type:"submit",class:"btn btn-primary"}," Add expense "),i("button",{type:"button",class:"btn btn-soft"}," Cancel ")],-1))])],32),v(B,{"is-loading":_.value},null,8,["is-loading"])],64))}}),Oe={},Ne={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-8"};function Te(e,t){return l(),o("svg",Ne,t[0]||(t[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z"},null,-1)]))}const Pe=ne(Oe,[["render",Te]]);function Ue(e){return{groupedByMonth:D(()=>{const r=e.value.reduce((a,s)=>{const n=new Date(s.date).toISOString().slice(0,7);return a[n]||(a[n]={totalAmount:0,expenses:{}}),a[n].totalAmount+=s.amount,s.$id&&(a[n].expenses[s.$id]=s),a},{});return Object.keys(r).sort((a,s)=>a.localeCompare(s)).reduce((a,s)=>(a[s]=r[s],a),{})})}}const Be=["checked","onChange"],Le={class:"collapse-title font-semibold border-b border-base-300"},Fe={class:"collapse-content text-sm"},je=E({__name:"GroupedPropertyExpenses",props:N({expenses:{}},{activeIndex:{},activeIndexModifiers:{}}),emits:["update:activeIndex"],setup(e){const t=T(e,"activeIndex"),r=e,a=n=>{t.value=t.value===n?"":n},{groupedByMonth:s}=Ue(ae(r,"expenses"));return(n,_)=>(l(!0),o($,null,j(d(s),(y,x,f)=>(l(),o("div",{key:f,class:le(["collapse collapse-arrow bg-base-100",{"collapse-open":f.toString()===t.value}])},[i("input",{type:"checkbox",class:"peer",checked:f.toString()===t.value,onChange:c=>a(f.toString())},null,40,Be),i("div",Le,p(x),1),i("div",Fe,[L(n.$slots,"default",{data:y})])],2))),128))}});function Ke(){const{locale:e}=K();return{format:r=>new Intl.NumberFormat(e.value,{style:"currency",currency:"MKD",currencyDisplay:"symbol",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}}const qe={class:"stats w-full"},Re={class:"stat"},Qe={key:0,class:"stat-figure text-secondary"},Ge={class:"w-16"},He={class:"stat-title"},ze={key:1,class:"stat-value"},Xe={key:2,class:"stat-desc"},Ze={key:3,class:"stat-actions"},P=E({__name:"TheStat",props:{title:{type:String,default:""},value:{type:[String,Number],default:""},description:{type:String,default:""}},setup(e){const{isMobile:t}=oe(),{format:r}=Ke(),s=r(e.value);return(n,_)=>(l(),o("div",qe,[i("div",Re,[d(t)?b("",!0):(l(),o("div",Qe,[i("div",Ge,[L(n.$slots,"image")])])),i("div",He,p(e.title),1),e.value?(l(),o("div",ze,p(d(s)),1)):b("",!0),e.description?(l(),o("div",Xe,p(e.description),1)):b("",!0),n.$slots.actions?(l(),o("div",Ze,[L(n.$slots,"actions")])):b("",!0)])]))}}),Je={class:"list relative bg-base-100 rounded-box shadow-md"},We={class:"p-4 text-xs opacity-60 tracking-wide"},Ye=["src","alt"],et={key:0,class:"join"},tt=["onClick"],st=["onClick"],nt={class:"mt-10 border border-base-300"},at=E({__name:"ListPropertyExpenses",props:{expenses:{},loadingItemId:{}},emits:["on-update-expense","on-delete-expense"],setup(e,{emit:t}){const r=z(),a=A("0"),{t:s}=K(),n=e,_=t,y=n.expenses.reduce((c,S)=>c+S.amount,0),x=c=>_("on-update-expense",c),f=c=>_("on-delete-expense",c);return(c,S)=>(l(),o("ul",Je,[i("li",We,[c.expenses&&c.expenses.length?(l(),o($,{key:0},[q(p(d(s)("expenses.property")),1)],64)):(l(),o($,{key:1},[q(p(d(s)("expenses.none")),1)],64))]),v(P,{title:d(s)("totalPending"),value:d(y)},null,8,["title","value"]),v(je,{"active-index":a.value,"onUpdate:activeIndex":S[0]||(S[0]=m=>a.value=m),expenses:c.expenses},{default:V(({data:m})=>[i("ul",null,[(l(!0),o($,null,j(m.expenses,u=>(l(),o("li",{key:`${c.loadingItemId}-${u.$id}`},[u.$id===c.loadingItemId?(l(),M(de,{key:0})):(l(),M(P,{key:1,title:u.category,value:u.amount},{image:V(()=>{var k;return[(k=d(I)[u.category])!=null&&k.imageUrl?(l(),o("img",{key:0,src:d(I)[u.category].imageUrl,alt:d(I)[u.category].label},null,8,Ye)):(l(),M(Pe,{key:1}))]}),actions:V(()=>[d(r).isLoggedIn?(l(),o("div",et,[u.isPaid?b("",!0):(l(),o("button",{key:0,class:"btn btn-success btn-xs join-item",onClick:k=>x(u)},p(d(s)("actions.markAsPaid")),9,tt)),i("button",{class:"btn btn-error btn-xs join-item",onClick:k=>f(u.$id)},p(d(s)("actions.delete")),9,st)])):b("",!0)]),_:2},1032,["title","value"]))]))),128))]),i("li",nt,[v(P,{title:d(s)("payment.total"),value:m.totalAmount},null,8,["title","value"])])]),_:1},8,["active-index","expenses"])]))}}),lt={class:"title text-2xl"},rt=E({__name:"PropertyDetailsPage",setup(e){const t=z(),r=H(),{t:a}=K(),s=A(!1),n=D(()=>r.params.id),_=G(),y=A(null),{data:x}=ie("$id",n.value),f=D(()=>{var g;return(g=x==null?void 0:x.value)==null?void 0:g.filter(w=>w.$id===n.value)[0]}),{data:c,isPending:S}=re({queryKey:["expenses",n.value],queryFn:()=>ge(n.value),enabled:D(()=>!!n.value),staleTime:1e3*60*5}),m=U({mutationFn:async g=>(y.value=g,await ye(g)),onSuccess:()=>{_.invalidateQueries({queryKey:["expenses"]})},onSettled:()=>{y.value=null}}),u=U({mutationFn:async g=>(y.value=g.$id,await fe(g.$id,{...g,isPaid:!0})),onSuccess:()=>{_.invalidateQueries({queryKey:["expenses"]})},onSettled:()=>{y.value=null}}),k=()=>s.value=!0,X=()=>s.value=!1,Z=g=>u.mutate(g),J=g=>m.mutate(g);return(g,w)=>(l(),o($,null,[v(ce,{class:"gap-4"},{default:V(()=>[v(R,{size:12,responsive:{lg:6},class:"content-center"},{default:V(()=>{var C;return[i("h1",lt,p((C=f.value)==null?void 0:C.name),1)]}),_:1}),v(R,{size:12,responsive:{lg:6},class:"text-right"},{default:V(()=>[d(t).isLoggedIn?(l(),o("button",{key:0,class:"btn btn-primary",onClick:k},p(d(a)("expenses.add")),1)):b("",!0)]),_:1})]),_:1}),w[1]||(w[1]=i("div",{class:"divider divider-warning"},null,-1)),v(B,{"is-loading":d(S)},null,8,["is-loading"]),d(c)?(l(),M(at,{key:0,onOnUpdateExpense:Z,onOnDeleteExpense:J,"loading-item-id":y.value,expenses:d(c)},null,8,["loading-item-id","expenses"])):b("",!0),v(ue,{title:"Add expense to property",modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=C=>s.value=C)},{default:V(()=>[v(Me,{onOnAddExpense:X})]),_:1},8,["modelValue"])],64))}});export{rt as default};
