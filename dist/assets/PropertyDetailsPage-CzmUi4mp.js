import{x as N,C,I as ce,Q as pe,d as $,y as B,z as L,c as r,q as V,A as q,t as m,B as H,b as a,o,D as me,F as I,m as R,u as J,r as k,E as D,a as F,e as p,f as T,g as d,_ as W,w as Z,G as Y,H as z,J as ve,K as ee,s as K,L as P,k as Q,M as fe,i as te,l as h,p as U,j as ge,N as ye,v as G}from"./index-4PKQoAsf.js";import{T as be,a as X,_ as xe}from"./TheSkeletonCircleContent-CflBSzGP.js";const M={DEFAULT:{abbr:"RENT",label:"Rent",value:"RENT",imageUrl:""},EVN:{abbr:"EVN",label:"EVN Group Macedonia",value:"EVN",imageUrl:"https://www.evn.mk/EVN/media/img/EVN-Logo.svg?ext=.svg"},VODOVOD:{abbr:"VODOVOD",label:"JP Vodovod",value:"VODOVOD",imageUrl:"https://vodovod-skopje.com.mk/images/logo_voda.png"},ESM:{abbr:"ESM",label:"ESM Snabduvanje so toplina",value:"ESM",imageUrl:"https://esm-snabduvanje.mk/wp-content/uploads/2022/12/logo_esm_privremeno.png"},URBAN:{abbr:"URBAN",label:"Urban Komfort",value:"URBAN",imageUrl:"https://urban.com.mk/img/logo-urbankonfort.png"},TELEKOM:{abbr:"TELEKOM",label:"Makedonski Telekom",value:"TELEKOM",imageUrl:"https://www.telekom.mk/images/telekom-logo.svg"}},se=()=>Object.keys(M).map(s=>{const t=s;return{label:M[t].label,value:M[t].value}});function _e(s){const t=Object.entries(s).filter(([u])=>!u.startsWith("$"));return Object.fromEntries(t)}async function Ee(s){try{return await N.createDocument(C.DATABASE_ID,C.COLLECTIONS.EXPENSES,ce.unique(),s)}catch(t){throw console.log(t),t}}async function he(s){try{return(await N.listDocuments(C.DATABASE_ID,C.COLLECTIONS.EXPENSES,[pe.equal("propertyId",s)])).documents}catch(t){throw console.log("error fetching expenses"),t}}async function ke(s){try{return await N.deleteDocument(C.DATABASE_ID,C.COLLECTIONS.EXPENSES,s)}catch(t){throw console.log(t),t}}async function Ve(s,t){const u=_e(t);try{return await N.updateDocument(C.DATABASE_ID,C.COLLECTIONS.EXPENSES,s,u)}catch(n){throw console.log(n),n}}const $e={class:"fieldset"},Se={key:0,class:"fieldset-label"},ne=$({__name:"InputDate",props:B({label:{type:String,default:""}},{modelValue:{type:[Date,String],default:new Date().toISOString()},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const t=L(s,"modelValue");return(u,n)=>(o(),r("fieldset",$e,[s.label?(o(),r("legend",Se,m(s.label),1)):V("",!0),q(a("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),type:"date",class:"input w-full"},null,512),[[H,t.value]])]))}}),we={class:"fieldset"},Ie={key:0,class:"fieldset-label"},Ce={disabled:"",selected:""},De=["value"],le=$({__name:"InputSelect",props:B({label:{type:String,default:""},defaultValue:{type:String,default:"Pick option"},items:{type:Array,default:()=>[{value:"single",label:"Single"}]}},{modelValue:{type:String},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const t=L(s,"modelValue");return(u,n)=>(o(),r("fieldset",we,[s.label?(o(),r("legend",Ie,m(s.label),1)):V("",!0),q(a("select",{"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),class:"select w-full"},[a("option",Ce,m(s.defaultValue),1),(o(!0),r(I,null,R(s.items,(e,l)=>(o(),r("option",{key:l,value:e.value},m(e.label),9,De))),128))],512),[[me,t.value]])]))}}),Ae={class:"fieldset"},Me={class:"fieldset-label"},Oe=["placeholder"],Ue={class:"fieldset-label"},oe=$({__name:"InputTextarea",props:B({label:{type:String,default:""},placeholder:{type:String,default:""},optionalText:{type:String,default:""}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const t=L(s,"modelValue");return(u,n)=>(o(),r("fieldset",Ae,[a("legend",Me,m(s.label),1),q(a("textarea",{"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),class:"textarea h-24 w-full",placeholder:s.placeholder},null,8,Oe),[[H,t.value]]),a("div",Ue,m(s.optionalText),1)]))}}),Pe={class:"fieldset w-full"},Te=$({__name:"AddExpenseToPropertyForm",emits:["on-add-expense"],setup(s,{emit:t}){const u=t,n=Y(),e=J(),l=k({propertyId:"",category:"Expense type",amount:0,description:"",date:new Date,isPaid:!1}),g=k(!1),E=D(()=>se()),{mutate:x,isPending:c}=F({mutationFn:Ee,onSuccess:()=>{e.invalidateQueries({queryKey:["expenses"]}),u("on-add-expense")}}),y=async()=>{x({...l.value,propertyId:n.params.id.toString()})};return(O,i)=>(o(),r(I,null,[a("form",{onSubmit:Z(y,["prevent"]),class:"flex justify-center align-center items-center"},[p(T,{"is-loading":d(c)},null,8,["is-loading"]),a("fieldset",Pe,[p(le,{modelValue:l.value.category,"onUpdate:modelValue":i[0]||(i[0]=b=>l.value.category=b),items:E.value,"default-value":"Expense type",label:"Expense categories"},null,8,["modelValue","items"]),p(W,{modelValue:l.value.amount,"onUpdate:modelValue":i[1]||(i[1]=b=>l.value.amount=b),label:"Amount",placeholder:"Amount",type:"number"},null,8,["modelValue"]),p(oe,{modelValue:l.value.description,"onUpdate:modelValue":i[2]||(i[2]=b=>l.value.description=b),label:"Description"},null,8,["modelValue"]),p(ne,{modelValue:l.value.date,"onUpdate:modelValue":i[3]||(i[3]=b=>l.value.date=b),label:"Date when expense is opened"},null,8,["modelValue"]),i[4]||(i[4]=a("div",{class:"flex w-full justify-end gap-2 mt-2"},[a("button",{type:"submit",class:"btn btn-primary"}," Add expense "),a("button",{type:"button",class:"btn btn-soft"}," Cancel ")],-1))])],32),p(T,{"is-loading":g.value},null,8,["is-loading"])],64))}}),Ne={class:"fieldset w-full"},Be=$({__name:"EditExpenseForm",props:{expense:{}},emits:["on-edit-confirm"],setup(s,{emit:t}){const u=s,n=t,e=k({propertyId:u.expense.propertyId||"",category:u.expense.category||"",amount:u.expense.amount||0,description:u.expense.description||"",date:u.expense.date||"",isPaid:u.expense.isPaid||!1}),l=k(!1),g=D(()=>se()),E=()=>n("on-edit-confirm",{...u.expense,...e.value});return(x,c)=>(o(),r(I,null,[a("form",{onSubmit:Z(E,["prevent"]),class:"flex justify-center align-center items-center"},[a("fieldset",Ne,[p(le,{modelValue:e.value.category,"onUpdate:modelValue":c[0]||(c[0]=y=>e.value.category=y),items:g.value,"default-value":"Expense type",label:"Expense categories"},null,8,["modelValue","items"]),p(W,{modelValue:e.value.amount,"onUpdate:modelValue":c[1]||(c[1]=y=>e.value.amount=y),label:"Amount",placeholder:"Amount",type:"number"},null,8,["modelValue"]),p(oe,{modelValue:e.value.description,"onUpdate:modelValue":c[2]||(c[2]=y=>e.value.description=y),label:"Description"},null,8,["modelValue"]),p(ne,{modelValue:e.value.date,"onUpdate:modelValue":c[3]||(c[3]=y=>e.value.date=y),label:"Date when expense is opened"},null,8,["modelValue"]),c[4]||(c[4]=a("div",{class:"flex w-full justify-end gap-2 mt-2"},[a("button",{type:"submit",class:"btn btn-primary"}," Edit ")],-1))])],32),p(T,{"is-loading":l.value},null,8,["is-loading"])],64))}}),Le={},je={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"};function Fe(s,t){return o(),r("svg",je,t[0]||(t[0]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"},null,-1)]))}const Ke=z(Le,[["render",Fe]]),qe={},Re={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-12"};function ze(s,t){return o(),r("svg",Re,t[0]||(t[0]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"},null,-1)]))}const Qe=z(qe,[["render",ze]]),Ge={},Xe={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"};function He(s,t){return o(),r("svg",Xe,t[0]||(t[0]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"},null,-1)]))}const Je=z(Ge,[["render",He]]);function We(s){return{groupedByMonth:D(()=>{const u=s.value.reduce((n,e)=>{const l=new Date(e.date).toISOString().slice(0,7);return n[l]||(n[l]={totalAmount:0,expenses:{}}),n[l].totalAmount+=e.amount,e.$id&&(n[l].expenses[e.$id]=e),n},{});return Object.keys(u).sort((n,e)=>n.localeCompare(e)).reduce((n,e)=>(n[e]=u[e],n),{})})}}const Ze=["checked","onChange"],Ye={class:"collapse-title font-semibold border-b border-base-300 flex gap-1 items-center"},et={class:"collapse-content text-sm"},tt=$({__name:"GroupedPropertyExpenses",props:B({expenses:{}},{activeIndex:{},activeIndexModifiers:{}}),emits:["update:activeIndex"],setup(s){const t=L(s,"activeIndex"),u=s,n=l=>{t.value=t.value===l?"":l},{groupedByMonth:e}=We(ve(u,"expenses"));return(l,g)=>(o(!0),r(I,null,R(d(e),(E,x,c)=>(o(),r("div",{key:c,class:ee(["collapse collapse-arrow bg-base-100",{"collapse-open":c.toString()===t.value}])},[a("input",{type:"checkbox",class:"peer",checked:c.toString()===t.value,onChange:y=>n(c.toString())},null,40,Ze),a("div",Ye,[p(Je),K(" "+m(x),1)]),a("div",et,[P(l.$slots,"default",{data:E})])],2))),128))}});function st(){const{locale:s}=Q();return{format:u=>new Intl.NumberFormat(s.value,{style:"currency",currency:"MKD",currencyDisplay:"symbol",minimumFractionDigits:0,maximumFractionDigits:0}).format(u)}}const nt={class:"stats w-full"},lt={class:"stat"},ot={key:0,class:"stat-figure text-secondary"},at={class:"w-16"},it={class:"stat-title text-accent"},rt={key:1,class:"stat-value"},ut={class:"stat-desc mb-2 text-accent"},dt={key:2,class:"stat-actions"},j=$({__name:"TheStat",props:{title:{type:String,default:""},value:{type:[String,Number],default:""},description:{type:String,default:""}},setup(s){const{isMobile:t}=fe(),{format:u}=st(),n=s,e=D(()=>u(n.value));return(l,g)=>(o(),r("div",nt,[a("div",lt,[d(t)?V("",!0):(o(),r("div",ot,[a("div",at,[P(l.$slots,"image")])])),a("div",it,m(s.title),1),s.value?(o(),r("div",rt,m(e.value),1)):V("",!0),a("div",ut,[P(l.$slots,"description")]),l.$slots.actions?(o(),r("div",dt,[P(l.$slots,"actions")])):V("",!0)])]))}}),ct={class:"list relative bg-base-100 rounded-box shadow-md"},pt={class:"p-4 text-xs opacity-60 tracking-wide"},mt={class:"flex items-center gap-1 text-sm"},vt={key:0},ft={key:1},gt=["src","alt"],yt={key:0,class:"join"},bt=["onClick"],xt=["onClick"],_t=["onClick"],Et=["onClick"],ht={class:"mt-10 border border-base-300"},kt=$({__name:"ListPropertyExpenses",props:{expenses:{},loadingItemId:{}},emits:["on-update-expense","on-delete-expense","on-edit-expense"],setup(s,{emit:t}){const u=te(),n=k("0"),{t:e}=Q(),l=s,g=t,E=l.expenses.reduce((i,b)=>i+b.amount,0),x=i=>g("on-update-expense",{...i}),c=i=>g("on-delete-expense",i),y=i=>g("on-edit-expense",i),O=i=>i?"border-l-[10px] border-l-success mt-4":"border-l-[10px] border-l-warning mt-4";return(i,b)=>(o(),r("ul",ct,[a("li",pt,[i.expenses&&i.expenses.length?(o(),r(I,{key:0},[K(m(d(e)("expenses.property")),1)],64)):(o(),r(I,{key:1},[K(m(d(e)("expenses.none")),1)],64))]),p(j,{title:d(e)("totalPending"),value:d(E)},null,8,["title","value"]),p(tt,{"active-index":n.value,"onUpdate:activeIndex":b[0]||(b[0]=A=>n.value=A),expenses:i.expenses},{default:h(({data:A})=>[a("ul",null,[(o(!0),r(I,null,R(A.expenses,f=>(o(),r("li",{key:`${i.loadingItemId}-${f.$id}`},[f.$id===i.loadingItemId?(o(),U(be,{key:0})):(o(),U(j,{key:1,title:f.category,value:f.amount,class:ee(O(f.isPaid))},{description:h(()=>[a("div",mt,[p(Ke),f.isPaid?(o(),r("span",vt,m(d(e)("payment.paid")),1)):(o(),r("span",ft,m(d(e)("payment.pending")),1))])]),image:h(()=>{var S;return[(S=d(M)[f.category])!=null&&S.imageUrl?(o(),r("img",{key:0,src:d(M)[f.category].imageUrl,alt:d(M)[f.category].label},null,8,gt)):(o(),U(Qe,{key:1}))]}),actions:h(()=>[d(u).isLoggedIn?(o(),r("div",yt,[f.isPaid?(o(),r("button",{key:1,class:"btn btn-warning btn-xs join-item",onClick:S=>x({...f,isPaid:!1})},m(d(e)("actions.markAsUnpaid")),9,xt)):(o(),r("button",{key:0,class:"btn btn-success btn-xs join-item",onClick:S=>x({...f,isPaid:!0})},m(d(e)("actions.markAsPaid")),9,bt)),a("button",{class:"btn btn-info btn-xs join-item",onClick:S=>y(f.$id)},m(d(e)("actions.edit")),9,_t),a("button",{class:"btn btn-error btn-xs join-item",onClick:S=>c(f.$id)},m(d(e)("actions.delete")),9,Et)])):V("",!0)]),_:2},1032,["title","value","class"]))]))),128))]),a("li",ht,[p(j,{title:d(e)("payment.total"),value:A.totalAmount},null,8,["title","value"])])]),_:1},8,["active-index","expenses"])]))}}),Vt={class:"title text-2xl"},wt=$({__name:"PropertyDetailsPage",setup(s){const t=te(),u=Y(),{t:n}=Q(),e=k(!1),l=k(!1),g=D(()=>u.params.id),E=J(),x=k(null),{data:c}=ge("$id",g.value),y=D(()=>{var v;return(v=c==null?void 0:c.value)==null?void 0:v.filter(_=>_.$id===g.value)[0]}),O=k(),{data:i,isPending:b}=ye({queryKey:["expenses",g.value],queryFn:()=>he(g.value),enabled:D(()=>!!g.value),staleTime:1e3*60*5}),A=F({mutationFn:async v=>(x.value=v,await ke(v)),onSuccess:()=>{E.invalidateQueries({queryKey:["expenses"]})},onSettled:()=>{x.value=null}}),f=F({mutationFn:async v=>(x.value=v.$id,await Ve(v.$id,v)),onSuccess:()=>{E.invalidateQueries({queryKey:["expenses"]})},onSettled:()=>{x.value=null,l.value=!1}}),S=()=>e.value=!0,ae=()=>e.value=!1,ie=v=>f.mutate(v),re=v=>A.mutate(v),ue=v=>{var _;console.log(i.value),O.value=(_=i.value)==null?void 0:_.find(w=>w.$id===v),l.value=!0},de=v=>f.mutate(v);return(v,_)=>(o(),r(I,null,[p(xe,{class:"gap-4"},{default:h(()=>[p(X,{size:12,responsive:{lg:6},class:"content-center"},{default:h(()=>{var w;return[a("h1",Vt,m((w=y.value)==null?void 0:w.name),1)]}),_:1}),p(X,{size:12,responsive:{lg:6},class:"text-right"},{default:h(()=>[d(t).isLoggedIn?(o(),r("button",{key:0,class:"btn btn-primary",onClick:S},m(d(n)("expenses.add")),1)):V("",!0)]),_:1})]),_:1}),_[2]||(_[2]=a("div",{class:"divider divider-warning"},null,-1)),p(T,{"is-loading":d(b)},null,8,["is-loading"]),d(i)?(o(),U(kt,{key:0,onOnUpdateExpense:ie,onOnDeleteExpense:re,onOnEditExpense:ue,"loading-item-id":x.value,expenses:d(i)},null,8,["loading-item-id","expenses"])):V("",!0),p(G,{title:"Edit expense",modelValue:l.value,"onUpdate:modelValue":_[0]||(_[0]=w=>l.value=w)},{default:h(()=>[l.value?(o(),U(Be,{key:0,expense:O.value,onOnEditConfirm:de},null,8,["expense"])):V("",!0)]),_:1},8,["modelValue"]),p(G,{title:d(n)("expenses.add"),modelValue:e.value,"onUpdate:modelValue":_[1]||(_[1]=w=>e.value=w)},{default:h(()=>[p(Te,{onOnAddExpense:ae})]),_:1},8,["title","modelValue"])],64))}});export{wt as default};
